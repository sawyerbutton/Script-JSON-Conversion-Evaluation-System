# å‰§æœ¬è¯„ä¼°ç³»ç»Ÿ - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## é¡¹ç›®æ–‡ä»¶è¯´æ˜

æ‚¨å·²è·å¾—ä»¥ä¸‹å¼€å‘èµ„æºï¼š

### ğŸ“‹ æ ¸å¿ƒæ–‡æ¡£
- `script_eval_development_checklist.md` - **è¯¦ç»†çš„å¼€å‘ä»»åŠ¡æ¸…å•**ï¼ˆ28å¤©å¼€å‘è®¡åˆ’ï¼‰
- `script_evaluation_report_cn.md` - **è¯„ä¼°æ–¹æ³•è®ºä¸­æ–‡æŠ¥å‘Š**ï¼ˆç†è®ºåŸºç¡€ï¼‰

### ğŸ’» ä»£ç ç¤ºä¾‹

#### 1. å®¢æˆ·ç«¯ä¸é…ç½®
- `deepseek_client.py` - DeepSeek APIå®¢æˆ·ç«¯å°è£…
  - å…¼å®¹OpenAIæ ¼å¼
  - åŒ…å«é‡è¯•æœºåˆ¶
  - Tokenè®¡è´¹è¿½è¸ª

#### 2. æ•°æ®æ¨¡å‹
- `scene_models.py` - Pydanticæ•°æ®æ¨¡å‹
  - åœºæ™¯1ï¼ˆæ ‡å‡†å‰§æœ¬ï¼‰æ¨¡å‹
  - åœºæ™¯2ï¼ˆæ•…äº‹å¤§çº²ï¼‰æ¨¡å‹
  - æ•°æ®éªŒè¯å‡½æ•°

#### 3. è¯„ä¼°æŒ‡æ ‡
- `deepeval_metrics.py` - DeepEvalè‡ªå®šä¹‰æŒ‡æ ‡
  - åœºæ™¯è¾¹ç•Œè¯„ä¼°
  - è§’è‰²æå–è¯„ä¼°
  - è‡ªä¸€è‡´æ€§è¯„ä¼°

#### 4. ä¸»ç¨‹åº
- `main_evaluator.py` - å®Œæ•´è¯„ä¼°æµç¨‹
  - å¤šå±‚è¯„ä¼°æ¶æ„
  - æŠ¥å‘Šç”Ÿæˆ
  - æ‰¹é‡å¤„ç†

## å¿«é€Ÿå¼€å§‹æ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install deepeval==0.21.0
pip install pydantic==2.5.0
pip install openai
pip install python-dotenv
pip install pandas numpy
pip install rich
```

### 2. é…ç½®API

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
DEEPSEEK_API_KEY=your_deepseek_api_key_here
```

### 3. è¿è¡Œç¬¬ä¸€ä¸ªè¯„ä¼°

```python
from main_evaluator import ScriptEvaluator, EvaluationConfig

# é…ç½®
config = EvaluationConfig(
    use_deepseek_judge=True,
    save_detailed_report=True
)

# åˆ›å»ºè¯„ä¼°å™¨
evaluator = ScriptEvaluator(config)

# å‡†å¤‡æµ‹è¯•æ•°æ®
test_case = {
    "source_text": "ä½ çš„å‰§æœ¬æ–‡æœ¬...",
    "extracted_json": {...},  # æå–çš„JSON
    "scene_type": "standard",
    "file_name": "test.txt"
}

# è¿è¡Œè¯„ä¼°
result = evaluator.evaluate_script(**test_case)
print(f"è¯„ä¼°å¾—åˆ†: {result.overall_score:.3f}")
print(f"è´¨é‡çº§åˆ«: {result.quality_level}")
```

## å¼€å‘ä¼˜å…ˆçº§å»ºè®®

### ç¬¬1å‘¨é‡ç‚¹
1. âœ… æ­å»ºåŸºç¡€ç¯å¢ƒ
2. âœ… å®ç°Pydanticæ¨¡å‹éªŒè¯
3. âœ… å®Œæˆç»“æ„å±‚è¯„ä¼°

### ç¬¬2å‘¨é‡ç‚¹
1. å®ç°LLM-as-Judge
2. é›†æˆDeepSeek API
3. å¼€å‘æ ¸å¿ƒè¯„ä¼°æŒ‡æ ‡

### ç¬¬3å‘¨é‡ç‚¹
1. å®ç°è‡ªä¸€è‡´æ€§æ£€æŸ¥
2. æ·»åŠ MINEAæµ‹è¯•
3. å®ŒæˆæŠ¥å‘Šç”Ÿæˆ

### ç¬¬4å‘¨é‡ç‚¹
1. æ€§èƒ½ä¼˜åŒ–
2. æ‰¹é‡å¤„ç†
3. éƒ¨ç½²å‡†å¤‡

## å…³é”®å†³ç­–ç‚¹

### 1. DeepSeekæ¨¡å‹é€‰æ‹©
- **deepseek-chat**: ç”¨äºè¯­ä¹‰è¯„ä¼°ï¼ˆæ¨èï¼‰
- **deepseek-coder**: ç”¨äºJSONç»“æ„åˆ†æ

### 2. è¯„ä¼°æƒé‡é…ç½®
```python
# å»ºè®®åˆå§‹æƒé‡
structure_weight = 0.25  # ç»“æ„éªŒè¯
boundary_weight = 0.25   # åœºæ™¯è¾¹ç•Œ
character_weight = 0.25  # è§’è‰²æå–
semantic_weight = 0.25   # è¯­ä¹‰å‡†ç¡®
```

### 3. æˆæœ¬æ§åˆ¶
- å¼€å‘é˜¶æ®µä½¿ç”¨å°æ ·æœ¬ï¼ˆ5-10ä¸ªï¼‰
- ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è°ƒç”¨
- ç›‘æ§Tokenä½¿ç”¨é‡

## æµ‹è¯•æ•°æ®å‡†å¤‡

### åœºæ™¯1ç¤ºä¾‹ï¼ˆæ ‡å‡†å‰§æœ¬ï¼‰
```json
{
  "scene_id": "S01",
  "setting": "å†…æ™¯ å’–å•¡é¦† - æ—¥",
  "characters": ["æé›·", "éŸ©æ¢…æ¢…"],
  "scene_mission": "å±•ç°å…³ç³»å±æœº",
  "key_events": ["äº‰åµçˆ†å‘", "åˆ†æ‰‹å®£è¨€"],
  "info_change": [...],
  "relation_change": [...],
  "key_object": [...],
  "setup_payoff": {...}
}
```

### åœºæ™¯2ç¤ºä¾‹ï¼ˆæ•…äº‹å¤§çº²ï¼‰
```json
{
  "scene_id": "S1",
  "setting": "æ¨æ–­ï¼šåŠå…¬å®¤",
  "characters": ["ä¸»è§’"],
  "scene_mission": "å»ºç«‹äººç‰©èƒŒæ™¯",
  "key_events": ["æ¥åˆ°ç¥ç§˜ç”µè¯"],
  ...
}
```

## å¸¸è§é—®é¢˜è§£å†³

### Q1: DeepSeek APIè°ƒç”¨å¤±è´¥
- æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç½‘ç»œè¿æ¥
- æŸ¥çœ‹æ˜¯å¦è§¦å‘é™æµ

### Q2: è¯„ä¼°åˆ†æ•°å¼‚å¸¸ä½
- æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦ç¬¦åˆschema
- éªŒè¯åœºæ™¯IDæ ¼å¼
- ç¡®è®¤å¿…éœ€å­—æ®µå®Œæ•´

### Q3: å†…å­˜å ç”¨è¿‡é«˜
- å‡å°‘å¹¶å‘è¯·æ±‚æ•°
- ä½¿ç”¨æ‰¹å¤„ç†è€Œéå…¨é‡åŠ è½½
- æ¸…ç†ç¼“å­˜æ•°æ®

## åç»­ä¼˜åŒ–æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°å¼‚æ­¥APIè°ƒç”¨
   - æ·»åŠ ç»“æœç¼“å­˜å±‚
   - ä¼˜åŒ–æ‰¹å¤„ç†é€»è¾‘

2. **åŠŸèƒ½æ‰©å±•**
   - æ”¯æŒæ›´å¤šå‰§æœ¬æ ¼å¼
   - æ·»åŠ å¯è§†åŒ–æŠ¥å‘Š
   - å®ç°å¢é‡è¯„ä¼°

3. **è´¨é‡æå‡**
   - æ”¶é›†äººå·¥æ ‡æ³¨æ•°æ®
   - ä¼˜åŒ–è¯„ä¼°Prompt
   - è°ƒæ•´æƒé‡é…ç½®

## è”ç³»ä¸æ”¯æŒ

å¦‚éœ€è¿›ä¸€æ­¥å¸®åŠ©ï¼Œå¯ä»¥ï¼š
1. æŸ¥é˜…è¯¦ç»†å¼€å‘æ¸…å•ï¼š`script_eval_development_checklist.md`
2. å‚è€ƒç†è®ºæŠ¥å‘Šï¼š`script_evaluation_report_cn.md`
3. è¿è¡Œç¤ºä¾‹ä»£ç è¿›è¡Œå®éªŒ

ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼ğŸ¬
