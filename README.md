# å‰§æœ¬JSONè½¬æ¢è¯„ä¼°ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº **DeepEval** æ¡†æ¶å’Œ **DeepSeek API** çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œæä¾›ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **å‰§æœ¬â†’JSONè‡ªåŠ¨è½¬æ¢**ï¼šä½¿ç”¨DeepSeek APIå°†å‰§æœ¬æ–‡æœ¬æ™ºèƒ½è½¬æ¢ä¸ºç»“æ„åŒ–JSONæ•°æ®
2. **è½¬æ¢è´¨é‡è¯„ä¼°**ï¼šé‡‡ç”¨ä¸‰å±‚è¯„ä¼°æ¶æ„éªŒè¯è½¬æ¢è´¨é‡

ç³»ç»Ÿæ”¯æŒæ ‡å‡†å‰§æœ¬å’Œæ•…äº‹å¤§çº²ä¸¤ç§åœºæ™¯ï¼Œæä¾›ä»è½¬æ¢åˆ°è¯„ä¼°çš„å®Œæ•´å·¥ä½œæµã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **å®Œæ•´çš„è½¬æ¢è¯„ä¼°å·¥ä½œæµ**
  - ä¸€é”®è½¬æ¢ï¼šå‰§æœ¬æ–‡æœ¬ â†’ ç»“æ„åŒ–JSON
  - è‡ªåŠ¨è¯„ä¼°ï¼šè½¬æ¢è´¨é‡å³æ—¶åé¦ˆ
  - 5ä¸ªæ ¸å¿ƒè„šæœ¬æ”¯æŒä¸åŒä½¿ç”¨åœºæ™¯

- ğŸ¯ **åŒåœºæ™¯æ”¯æŒ**
  - **æ ‡å‡†å‰§æœ¬ï¼ˆStandardï¼‰**ï¼šä¸¥æ ¼éªŒè¯è§„åˆ™ï¼Œscene_idå¿…é¡»S01æ ¼å¼ï¼Œsettingå¿…é¡»åŒ…å«"å†…/å¤–"
  - **æ•…äº‹å¤§çº²ï¼ˆOutlineï¼‰**ï¼šçµæ´»éªŒè¯è§„åˆ™ï¼Œscene_idå¯ä»¥æ˜¯S0/S1ï¼Œsettingå…è®¸æ¨æ–­

- âœ… **ä¸‰å±‚è¯„ä¼°æ¶æ„**
  - **ç»“æ„å±‚**ï¼šPydantic V2æ¨¡å‹éªŒè¯JSONæ ¼å¼ã€å­—æ®µå®Œæ•´æ€§
  - **ç»Ÿè®¡å±‚**ï¼šåœºæ™¯è¾¹ç•ŒF1åˆ†æ•°ã€è§’è‰²æå–å‡†ç¡®ç‡
  - **è¯­ä¹‰å±‚**ï¼šDeepSeek LLMè¯„ä¼°åœºæ™¯ä»»åŠ¡ã€å…³é”®äº‹ä»¶ã€ä¿¡æ¯/å…³ç³»å˜åŒ–

- ğŸ“Š **å…¨é¢çš„è´¨é‡æŒ‡æ ‡**
  - ç»“æ„éªŒè¯ï¼šå­—æ®µæ ¼å¼ã€ç±»å‹ã€å¿…å¡«é¡¹æ£€æŸ¥
  - åœºæ™¯è¾¹ç•Œï¼šF1ã€Precisionã€Recall
  - è§’è‰²æå–ï¼šå‡†ç¡®ç‡ã€ä¸€è‡´æ€§
  - è¯­ä¹‰å‡†ç¡®ï¼šåœºæ™¯ä»»åŠ¡åŒ¹é…åº¦ã€å…³é”®äº‹ä»¶è¦†ç›–ç‡

- ğŸ¤– **æ™ºèƒ½LLMé›†æˆ**
  - DeepSeek APIè‡ªåŠ¨è½¬æ¢å‰§æœ¬ä¸ºJSON
  - **æ™ºèƒ½æ¨¡å‹é€‰æ‹©**ï¼šè‡ªåŠ¨æ ¹æ®æ–‡ä»¶å¤§å°é€‰æ‹©æœ€ä½³æ¨¡å‹
    - å°æ–‡ä»¶ï¼ˆ< 12Kå­—ç¬¦ï¼‰ï¼šdeepseek-chatï¼ˆ8Kè¾“å‡ºï¼Œé€Ÿåº¦å¿«ï¼‰
    - å¤§æ–‡ä»¶ï¼ˆ>= 12Kå­—ç¬¦ï¼‰ï¼šdeepseek-reasonerï¼ˆ32Kè¾“å‡ºï¼Œæ”¯æŒå¤æ‚æ¨ç†ï¼‰
  - ä¸“é—¨ä¼˜åŒ–çš„promptæ¨¡æ¿ï¼ˆscene1/scene2ï¼‰
  - LLM-as-Judgeè¯­ä¹‰è¯„ä¼°
  - æ™ºèƒ½é‡è¯•å’Œé”™è¯¯å¤„ç†
  - **å¼ºå¤§çš„åå¤„ç†ç³»ç»Ÿ**ï¼šè‡ªåŠ¨æ¸…ç†æ€è€ƒè¿‡ç¨‹ï¼Œæå–JSONï¼Œä¿®å¤å¸¸è§é—®é¢˜

- ğŸ“ **æ¸…æ™°çš„é¡¹ç›®ç»“æ„**
  - è¾“å‡ºæ–‡ä»¶è‡ªåŠ¨åˆ†ç±»ç®¡ç†ï¼ˆoutputs/converted/, outputs/reports/ï¼‰
  - æ”¯æŒæ‰¹é‡å¤„ç†è„šæœ¬
  - å®Œæ•´çš„å‚è€ƒæ–‡æ¡£ç³»ç»Ÿ

## é¡¹ç›®ç»“æ„

```
Script-JSON-Conversion-Evaluation-System/
â”‚
â”œâ”€â”€ src/                      # æºä»£ç 
â”‚   â”œâ”€â”€ models/               # Pydantic V2æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ scene_models.py   # SceneInfo & OutlineSceneInfo
â”‚   â”œâ”€â”€ metrics/              # è¯„ä¼°æŒ‡æ ‡
â”‚   â”‚   â””â”€â”€ deepeval_metrics.py
â”‚   â”œâ”€â”€ llm/                  # LLMé›†æˆ
â”‚   â”‚   â””â”€â”€ deepseek_client.py
â”‚   â”œâ”€â”€ evaluators/           # è¯„ä¼°å™¨
â”‚   â”‚   â””â”€â”€ main_evaluator.py
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ file_handler.py
â”‚
â”œâ”€â”€ scripts/                  # æ ¸å¿ƒè„šæœ¬
â”‚   â”œâ”€â”€ test_system.py        # ç³»ç»Ÿæµ‹è¯•ï¼ˆæ— éœ€APIï¼‰
â”‚   â”œâ”€â”€ convert_script_to_json.py      # æ ‡å‡†å‰§æœ¬â†’JSONè½¬æ¢
â”‚   â”œâ”€â”€ convert_outline_to_json.py     # æ•…äº‹å¤§çº²â†’JSONè½¬æ¢
â”‚   â”œâ”€â”€ run_full_evaluation.py         # æ ‡å‡†å‰§æœ¬å®Œæ•´è¯„ä¼°
â”‚   â”œâ”€â”€ run_outline_evaluation.py      # æ•…äº‹å¤§çº²å®Œæ•´è¯„ä¼°
â”‚   â”œâ”€â”€ batch_test_all_scripts.py      # æ‰¹é‡æµ‹è¯•æ‰€æœ‰å‰§æœ¬
â”‚   â””â”€â”€ test_single_large_file.py      # å•æ–‡ä»¶æµ‹è¯•å·¥å…·
â”‚
â”œâ”€â”€ script_examples/          # æµ‹è¯•æ ·æœ¬
â”‚   â”œâ”€â”€ scripts/              # æ ‡å‡†å‰§æœ¬ç¤ºä¾‹
â”‚   â”‚   â”œâ”€â”€ script_01_wuxia_tech.md
â”‚   â”‚   â”œâ”€â”€ script_02_palace_tech.md
â”‚   â”‚   â”œâ”€â”€ script_03_cultivation_tech.md
â”‚   â”‚   â””â”€â”€ script_04_ecommerce_ancient.md
â”‚   â””â”€â”€ outlines/             # æ•…äº‹å¤§çº²ç¤ºä¾‹
â”‚       â””â”€â”€ outline_01_time_traveler.md
â”‚
â”œâ”€â”€ prompts/                  # Promptæ¨¡æ¿
â”‚   â”œâ”€â”€ scene1_extraction.txt      # æ ‡å‡†å‰§æœ¬è½¬æ¢prompt
â”‚   â”œâ”€â”€ scene2_extraction.txt      # æ•…äº‹å¤§çº²è½¬æ¢prompt
â”‚   â”œâ”€â”€ boundary_evaluation.txt    # åœºæ™¯è¾¹ç•Œè¯„ä¼°prompt
â”‚   â””â”€â”€ semantic_evaluation.txt    # è¯­ä¹‰è¯„ä¼°prompt
â”‚
â”œâ”€â”€ configs/                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ default_config.yaml
â”‚   â”œâ”€â”€ evaluation_weights.yaml
â”‚   â””â”€â”€ deepseek_config.yaml
â”‚
â”œâ”€â”€ ref/                      # å‚è€ƒæ–‡æ¡£
â”‚   â”œâ”€â”€ scripts-guide.md      # è„šæœ¬ä½¿ç”¨æŒ‡å—ï¼ˆ413è¡Œï¼‰
â”‚   â”œâ”€â”€ models-reference.md   # æ¨¡å‹å‚è€ƒæ–‡æ¡£ï¼ˆ477è¡Œï¼‰
â”‚   â”œâ”€â”€ project-overview.md
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ development.md
â”‚   â””â”€â”€ api-reference.md
â”‚
â”œâ”€â”€ docs/                     # å…¶ä»–æ–‡æ¡£
â”‚   â”œâ”€â”€ project_structure.md
â”‚   â”œâ”€â”€ script_eval_development_checklist.md
â”‚   â””â”€â”€ OPTIMIZATION_SUMMARY_2025-11-01.md  # å¤§æ–‡ä»¶ä¼˜åŒ–æ€»ç»“
â”‚
â”œâ”€â”€ tests/                    # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ test_data/
â”‚
â”œâ”€â”€ outputs/                  # è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œå·².gitignoreï¼‰
â”‚   â”œâ”€â”€ converted/            # è½¬æ¢åçš„JSONæ–‡ä»¶
â”‚   â””â”€â”€ reports/              # è¯„ä¼°æŠ¥å‘Š
â”‚
â”œâ”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ CLAUDE.md                 # AIå¼€å‘åŠ©æ‰‹å‚è€ƒæ–‡æ¡£
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd Script-JSON-Conversion-Evaluation-System

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®API

åˆ›å»º `.env` æ–‡ä»¶å¹¶æ·»åŠ DeepSeek API Keyï¼š

```bash
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œæ·»åŠ ï¼šDEEPSEEK_API_KEY=your_api_key_here
```

### 3. è¿è¡Œç³»ç»Ÿæµ‹è¯•ï¼ˆæ— éœ€APIï¼‰

```bash
python scripts/test_system.py
```

### 4. ä½¿ç”¨æ ¸å¿ƒè„šæœ¬

#### åœºæ™¯Aï¼šåªåšè½¬æ¢ï¼ˆä¸è¯„ä¼°ï¼‰

```bash
# è½¬æ¢æ ‡å‡†å‰§æœ¬
python scripts/convert_script_to_json.py script_examples/scripts/script_01_wuxia_tech.md

# è½¬æ¢æ•…äº‹å¤§çº²
python scripts/convert_outline_to_json.py script_examples/outlines/outline_01_time_traveler.md

# è¾“å‡ºä½ç½®ï¼šoutputs/converted/
```

#### åœºæ™¯Bï¼šå®Œæ•´æµç¨‹ï¼ˆè½¬æ¢+è¯„ä¼°ï¼‰

```bash
# æ ‡å‡†å‰§æœ¬ï¼šè½¬æ¢+è¯„ä¼°ï¼ˆé»˜è®¤å¯ç”¨LLMè¯­ä¹‰è¯„ä¼°ï¼‰
python scripts/run_full_evaluation.py script_examples/scripts/script_01_wuxia_tech.md

# æ•…äº‹å¤§çº²ï¼šè½¬æ¢+è¯„ä¼°
python scripts/run_outline_evaluation.py script_examples/outlines/outline_01_time_traveler.md

# è¾“å‡ºä½ç½®ï¼š
# - JSON: outputs/converted/
# - æŠ¥å‘Š: outputs/reports/
```

#### åœºæ™¯Cï¼šèŠ‚çœAPIè°ƒç”¨ï¼ˆè·³è¿‡LLMè¯„ä¼°ï¼‰

```bash
# ä¸ä½¿ç”¨LLMè¯­ä¹‰è¯„ä¼°ï¼ˆæ›´å¿«ã€æ›´ä¾¿å®œï¼‰
python scripts/run_full_evaluation.py script_examples/scripts/script_01_wuxia_tech.md --no-llm-judge
```

#### åœºæ™¯Dï¼šæ‰¹é‡å¤„ç†

```bash
# æ‰¹é‡è½¬æ¢æ‰€æœ‰å‰§æœ¬
for file in script_examples/scripts/*.md; do
    python scripts/run_full_evaluation.py "$file"
done
```

### 5. ä½¿ç”¨Python APIï¼ˆé«˜çº§ç”¨æ³•ï¼‰

```python
# æ–¹å¼1ï¼šä½¿ç”¨è½¬æ¢è„šæœ¬ï¼ˆæ¨èï¼‰
from scripts.convert_script_to_json import convert_script_to_json
from utils.file_handler import FileHandler

file_handler = FileHandler()
script_text = file_handler.read_text_file("script_examples/scripts/script_01_wuxia_tech.md")
json_data = convert_script_to_json(script_text, scene_type="standard")

# æ–¹å¼2ï¼šä½¿ç”¨è¯„ä¼°å™¨API
from src.evaluators.main_evaluator import ScriptEvaluator, EvaluationConfig

config = EvaluationConfig(
    use_deepseek_judge=True,  # å¯ç”¨LLMè¯­ä¹‰è¯„ä¼°
    save_detailed_report=True
)

evaluator = ScriptEvaluator(config)

result = evaluator.evaluate_script(
    source_text=script_text,
    extracted_json=json_data,
    scene_type="standard",  # æˆ– "outline"
    source_file="script_01_wuxia_tech.md"
)

print(f"æ€»åˆ†: {result.overall_score:.3f}")
print(f"è´¨é‡çº§åˆ«: {result.quality_level}")
print(f"é€šè¿‡: {'âœ…' if result.passed else 'âŒ'}")
```

## ğŸ“‹ å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### ç¤ºä¾‹ï¼šæ ‡å‡†å‰§æœ¬å®Œæ•´è¯„ä¼°

#### è¾“å…¥ï¼šå‰§æœ¬æ–‡æœ¬æ–‡ä»¶

```markdown
# æ–‡ä»¶: script_examples/scripts/script_01_wuxia_tech.md

å†…æ™¯ å’–å•¡é¦† - æ—¥

æé›·ååœ¨è§’è½é‡Œï¼Œä¸å®‰åœ°çœ‹ç€æ‰‹è¡¨ã€‚éŸ©æ¢…æ¢…æ¨é—¨è€Œå…¥ï¼Œè¡¨æƒ…å†·æ¼ ã€‚

éŸ©æ¢…æ¢…
ï¼ˆå†·æ·¡åœ°ï¼‰
ä½ æƒ³è¯´ä»€ä¹ˆï¼Ÿ

æé›·
ï¼ˆç´§å¼ ï¼‰
æˆ‘...æˆ‘æƒ³è§£é‡Šä¸Šæ¬¡çš„äº‹ã€‚

éŸ©æ¢…æ¢…ç«™ç€ä¸åŠ¨ï¼Œé¢æ— è¡¨æƒ…åœ°çœ‹ç€ä»–ã€‚

éŸ©æ¢…æ¢…
æ²¡å¿…è¦äº†ã€‚æˆ‘ä»¬ç»“æŸå§ã€‚

éŸ©æ¢…æ¢…è½¬èº«ç¦»å¼€ï¼Œæé›·å‘†ååŸåœ°ã€‚
```

#### æ‰§è¡Œï¼šè¿è¡Œè¯„ä¼°è„šæœ¬

```bash
python scripts/run_full_evaluation.py script_examples/scripts/script_01_wuxia_tech.md
```

#### è¾“å‡ºï¼šè¯„ä¼°ç»“æœ

```
======================================================================
å‰§æœ¬JSONè½¬æ¢è¯„ä¼°ç³»ç»Ÿ - å®Œæ•´è¯„ä¼°æµç¨‹
======================================================================

[æ­¥éª¤ 1/3] è¯»å–å‰§æœ¬æ–‡ä»¶: script_examples/scripts/script_01_wuxia_tech.md
  æ–‡ä»¶å¤§å°: 234 å­—ç¬¦

[æ­¥éª¤ 2/3] ä½¿ç”¨DeepSeek APIè½¬æ¢å‰§æœ¬ä¸ºJSON...
  åœºæ™¯ç±»å‹: standard
æ­£åœ¨è°ƒç”¨DeepSeek APIè½¬æ¢å‰§æœ¬...
âœ… JSONè§£ææˆåŠŸï¼ŒåŒ…å« 1 ä¸ªåœºæ™¯

éªŒè¯JSONæ ¼å¼...
  åœºæ™¯1: âœ… éªŒè¯é€šè¿‡
  âœ… JSONå·²ä¿å­˜åˆ°: outputs/converted/æµ‹è¯•1_output.json

[æ­¥éª¤ 3/3] è¿è¡Œè´¨é‡è¯„ä¼°...
  ä½¿ç”¨LLMè¯­ä¹‰è¯„ä¼°: æ˜¯

======================================================================
è¯„ä¼°ç»“æœ
======================================================================

æ–‡ä»¶: script_examples/scripts/script_01_wuxia_tech.md
è´¨é‡çº§åˆ«: ä¼˜ç§€
æ€»åˆ†: 0.865
é€šè¿‡: âœ… æ˜¯

å„é¡¹å¾—åˆ†:
  ç»“æ„éªŒè¯: 1.000
  åœºæ™¯è¾¹ç•Œ: 1.000
  è§’è‰²æå–: 0.709
  è¯­ä¹‰å‡†ç¡®: 0.750

ç»Ÿè®¡ä¿¡æ¯:
  åœºæ™¯æ€»æ•°: 1
  è§’è‰²æ€»æ•°: 2

======================================================================
âœ… è¯„ä¼°å®Œæˆï¼
======================================================================
```

#### ç”Ÿæˆçš„æ–‡ä»¶

```
outputs/
â”œâ”€â”€ converted/
â”‚   â””â”€â”€ script_01_wuxia_tech_output.json  # è½¬æ¢åçš„JSON
â””â”€â”€ reports/
    â””â”€â”€ report_2025-11-01T13:30:00.json   # è¯¦ç»†è¯„ä¼°æŠ¥å‘Š
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. æ ¸å¿ƒè„šæœ¬ (scripts/)

**7ä¸ªè„šæœ¬ï¼Œè¦†ç›–æ‰€æœ‰ä½¿ç”¨åœºæ™¯ï¼š**

| è„šæœ¬ | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| `test_system.py` | ç³»ç»Ÿæµ‹è¯• | æ—  | æµ‹è¯•ç»“æœ |
| `convert_script_to_json.py` | æ ‡å‡†å‰§æœ¬è½¬æ¢ | å‰§æœ¬.md | JSON |
| `convert_outline_to_json.py` | æ•…äº‹å¤§çº²è½¬æ¢ | å¤§çº².md | JSON |
| `run_full_evaluation.py` | æ ‡å‡†å‰§æœ¬å®Œæ•´è¯„ä¼° | å‰§æœ¬.md | JSON + æŠ¥å‘Š |
| `run_outline_evaluation.py` | æ•…äº‹å¤§çº²å®Œæ•´è¯„ä¼° | å¤§çº².md | JSON + æŠ¥å‘Š |
| `batch_test_all_scripts.py` | æ‰¹é‡æµ‹è¯•æ‰€æœ‰å‰§æœ¬ | script_examples/scripts/ | æ‰¹é‡ç»“æœæŠ¥å‘Š |
| `test_single_large_file.py` | å•æ–‡ä»¶æµ‹è¯•å·¥å…· | å¤§æ–‡ä»¶è·¯å¾„ | æµ‹è¯•ç»“æœ |

è¯¦è§ï¼š[ref/scripts-guide.md](ref/scripts-guide.md)

### 2. æ•°æ®æ¨¡å‹ (src/models/)

**Pydantic V2ä¸¥æ ¼éªŒè¯ï¼š**

- **`SceneInfo`**ï¼ˆæ ‡å‡†å‰§æœ¬ï¼‰
  - scene_id: S01, S02æ ¼å¼
  - setting: å¿…é¡»åŒ…å«"å†…/å¤–"
  - key_events: 1-3ä¸ª

- **`OutlineSceneInfo`**ï¼ˆæ•…äº‹å¤§çº²ï¼‰
  - scene_id: S0, S1, S01éƒ½å¯ä»¥
  - setting: å…è®¸"æ¨æ–­ï¼š"ã€"èƒŒæ™¯è¯´æ˜"
  - key_events: 1-5ä¸ª

- **æ”¯æŒæ¨¡å‹**
  - `InfoChange`: ä¿¡æ¯å˜åŒ–
  - `RelationChange`: å…³ç³»å˜åŒ–
  - `KeyObject`: å…³é”®ç‰©å“
  - `SetupPayoff`: ä¼ç¬”ä¸å›æ”¶

è¯¦è§ï¼š[ref/models-reference.md](ref/models-reference.md)

### 3. è¯„ä¼°æŒ‡æ ‡ (src/metrics/)

**ä¸‰å±‚è¯„ä¼°æ¶æ„ï¼š**

- **ç»“æ„å±‚**ï¼šJSON schemaéªŒè¯ï¼ˆPydanticï¼‰
- **ç»Ÿè®¡å±‚**ï¼š
  - `SceneBoundaryMetric`: F1ã€Precisionã€Recall
  - `CharacterExtractionMetric`: è§’è‰²æå–å‡†ç¡®ç‡
- **è¯­ä¹‰å±‚**ï¼š
  - DeepSeek LLMè¯„ä¼°åœºæ™¯ä»»åŠ¡ã€å…³é”®äº‹ä»¶
  - ä¿¡æ¯å˜åŒ–ã€å…³ç³»å˜åŒ–åŒ¹é…åº¦

### 4. LLMé›†æˆ (src/llm/)

**DeepSeekå®¢æˆ·ç«¯åŠŸèƒ½ï¼š**

- OpenAIå…¼å®¹æ¥å£
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- Tokenç»Ÿè®¡å’Œæˆæœ¬è¿½è¸ª
- æ”¯æŒä¸¤ä¸ªæ¸©åº¦æ¨¡å¼ï¼ˆ0.1æ ‡å‡†å‰§æœ¬ï¼Œ0.2æ•…äº‹å¤§çº²ï¼‰

### 5. è¯„ä¼°å™¨ (src/evaluators/)

**ä¸»è¯„ä¼°å™¨åè°ƒï¼š**

- ä¸‰å±‚è¯„ä¼°æµç¨‹ç¼–æ’
- æƒé‡ç®¡ç†å’Œåˆ†æ•°èšåˆ
- æŠ¥å‘Šç”Ÿæˆï¼ˆJSONæ ¼å¼ï¼‰
- è´¨é‡çº§åˆ«åˆ¤å®šï¼ˆä¼˜ç§€/è‰¯å¥½/åˆæ ¼/ä¸åˆæ ¼ï¼‰

## é…ç½®è¯´æ˜

### è¯„ä¼°æƒé‡é…ç½®

ç¼–è¾‘ `configs/evaluation_weights.yaml`:

```yaml
weights:
  structure: 0.25    # ç»“æ„éªŒè¯æƒé‡
  boundary: 0.25     # åœºæ™¯è¾¹ç•Œæƒé‡
  character: 0.25    # è§’è‰²æå–æƒé‡
  semantic: 0.25     # è¯­ä¹‰å‡†ç¡®æƒé‡
```

### DeepSeek APIé…ç½®

ç¼–è¾‘ `configs/deepseek_config.yaml`:

```yaml
api:
  model: "deepseek-chat"
  temperature: 0.1
  max_retries: 3

cost_tracking:
  enabled: true
  daily_limit: 100.0  # æ¯æ—¥é¢„ç®—ï¼ˆäººæ°‘å¸ï¼‰
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„è¯„ä¼°æŒ‡æ ‡

1. åœ¨ `src/metrics/` åˆ›å»ºæ–°çš„æŒ‡æ ‡ç±»
2. ç»§æ‰¿ `deepeval.metrics.BaseMetric`
3. å®ç° `measure()` å’Œ `a_measure()` æ–¹æ³•
4. åœ¨ä¸»è¯„ä¼°å™¨ä¸­é›†æˆ

### è‡ªå®šä¹‰Promptæ¨¡æ¿

ç¼–è¾‘ `prompts/` ç›®å½•ä¸‹çš„æ¨¡æ¿æ–‡ä»¶ï¼Œè‡ªå®šä¹‰è¯„ä¼°æ ‡å‡†å’Œè¾“å‡ºæ ¼å¼ã€‚

### è¿è¡Œæµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
pytest tests/unit/

# é›†æˆæµ‹è¯•
pytest tests/integration/

# ç³»ç»Ÿæµ‹è¯•
python scripts/test_system.py
```

## ğŸ“š æ–‡æ¡£

### æ ¸å¿ƒå‚è€ƒæ–‡æ¡£
- ğŸ“˜ [è„šæœ¬ä½¿ç”¨æŒ‡å—](ref/scripts-guide.md) - 5ä¸ªè„šæœ¬çš„å®Œæ•´ä½¿ç”¨è¯´æ˜ï¼ˆ413è¡Œï¼‰
- ğŸ“— [æ¨¡å‹å‚è€ƒæ–‡æ¡£](ref/models-reference.md) - Pydanticæ¨¡å‹è¯¦ç»†è¯´æ˜ï¼ˆ477è¡Œï¼‰
- ğŸ“™ [AIå¼€å‘åŠ©æ‰‹æŒ‡å—](CLAUDE.md) - AIè¾…åŠ©å¼€å‘å‚è€ƒ

### è¯¦ç»†æ–‡æ¡£
- ğŸ—ï¸ [æ¶æ„è®¾è®¡](ref/architecture.md) - ä¸‰å±‚è¯„ä¼°æ¶æ„è¯¦è§£
- ğŸ”§ [å¼€å‘æŒ‡å—](ref/development.md) - æ·»åŠ æ–°åŠŸèƒ½ã€æœ€ä½³å®è·µ
- ğŸ“– [APIå‚è€ƒ](ref/api-reference.md) - Python APIè¯¦ç»†æ–‡æ¡£
- ğŸŒŸ [é¡¹ç›®æ¦‚è§ˆ](ref/project-overview.md) - å¿«é€Ÿäº†è§£é¡¹ç›®

### å…¶ä»–æ–‡æ¡£
- ğŸ“‚ [é¡¹ç›®ç»“æ„è¯´æ˜](docs/project_structure.md)
- âœ… [å¼€å‘ä»»åŠ¡æ¸…å•](docs/script_eval_development_checklist.md)
- âš¡ [å¤§æ–‡ä»¶ä¼˜åŒ–æ€»ç»“](docs/OPTIMIZATION_SUMMARY_2025-11-01.md) - DeepSeek Reasoneræ¨¡å‹é›†æˆä¸åå¤„ç†ä¼˜åŒ–

## æŠ€æœ¯æ ˆ

- **è¯„ä¼°æ¡†æ¶**: DeepEval 0.21+
- **LLM Provider**: DeepSeek API
- **æ•°æ®éªŒè¯**: Pydantic 2.5+
- **APIå®¢æˆ·ç«¯**: OpenAI Python SDK
- **é…ç½®ç®¡ç†**: PyYAML
- **æ•°æ®å¤„ç†**: Pandas, NumPy
- **æµ‹è¯•æ¡†æ¶**: Pytest

## ğŸ—ºï¸ è·¯çº¿å›¾

### âœ… å·²å®Œæˆï¼ˆv0.2.1 - 2025-11-01ï¼‰
- [x] **å¤§æ–‡ä»¶ä¼˜åŒ–**ï¼šæ™ºèƒ½æ¨¡å‹é€‰æ‹©ç³»ç»Ÿ
  - è‡ªåŠ¨æ ¹æ®æ–‡ä»¶å¤§å°ï¼ˆ12Ké˜ˆå€¼ï¼‰é€‰æ‹©æœ€ä½³æ¨¡å‹
  - å°æ–‡ä»¶ä½¿ç”¨deepseek-chatï¼ˆ8Kè¾“å‡ºï¼Œå¿«é€Ÿï¼‰
  - å¤§æ–‡ä»¶ä½¿ç”¨deepseek-reasonerï¼ˆ32Kè¾“å‡ºï¼Œæ”¯æŒå¤æ‚æ¨ç†ï¼‰
- [x] **åå¤„ç†å¢å¼º**ï¼šæ€è€ƒè¿‡ç¨‹æå–å’ŒJSONä¿®å¤
  - å…è®¸reasoneræ¨¡å‹è‡ªç”±æ€è€ƒï¼ˆæé«˜è¾“å‡ºè´¨é‡ï¼‰
  - è‡ªåŠ¨æ¸…ç†`<think>`æ ‡ç­¾ï¼Œç²¾ç¡®æå–JSON
  - æ™ºèƒ½ä¿®å¤å¸¸è§JSONé”™è¯¯ï¼ˆç¼ºå¤±æ‹¬å·ã€å°¾éƒ¨é€—å·ï¼‰
- [x] **å…¨é‡æµ‹è¯•éªŒè¯**ï¼š16ä¸ªå‰§æœ¬æ–‡ä»¶å®Œæ•´æµ‹è¯•
  - æµ‹è¯•ç»“æœï¼š100%è½¬æ¢æˆåŠŸç‡ï¼Œ93.75%è¯„ä¼°é€šè¿‡ç‡
  - å¹³å‡è´¨é‡åˆ†æ•°ï¼š0.753ï¼Œå¤„ç†æœ€å¤§41åœºæ™¯å¤æ‚å‰§æœ¬
  - éªŒè¯æ™ºèƒ½æ¨¡å‹é€‰æ‹©ã€å¤§æ–‡ä»¶å¤„ç†ã€åå¤„ç†ç³»ç»Ÿç¨³å¥æ€§
  - ç”Ÿæˆä¸“ä¸šHTMLæµ‹è¯•æŠ¥å‘Šï¼ˆoutputs/reports/batch_test_report_2025-11-01.htmlï¼‰
- [x] æ‰¹é‡æµ‹è¯•è„šæœ¬ï¼ˆbatch_test_all_scripts.pyï¼‰
- [x] å•æ–‡ä»¶æµ‹è¯•å·¥å…·ï¼ˆtest_single_large_file.pyï¼‰
- [x] è¯¦ç»†ä¼˜åŒ–æ–‡æ¡£ï¼ˆdocs/OPTIMIZATION_SUMMARY_2025-11-01.mdï¼‰

### âœ… å·²å®Œæˆï¼ˆv0.2.0ï¼‰
- [x] Pydantic V2å®Œæ•´è¿ç§»
- [x] æ ‡å‡†å‰§æœ¬å’Œæ•…äº‹å¤§çº²åŒåœºæ™¯æ”¯æŒ
- [x] 5ä¸ªæ ¸å¿ƒè„šæœ¬ï¼ˆè½¬æ¢Ã—2 + è¯„ä¼°Ã—2 + æµ‹è¯•Ã—1ï¼‰
- [x] ä¸‰å±‚è¯„ä¼°æ¶æ„ï¼ˆç»“æ„+ç»Ÿè®¡+è¯­ä¹‰ï¼‰
- [x] DeepSeek APIé›†æˆ
- [x] è¾“å‡ºç›®å½•é‡æ„ï¼ˆoutputs/converted/ + outputs/reports/ï¼‰
- [x] å®Œæ•´å‚è€ƒæ–‡æ¡£ç³»ç»Ÿï¼ˆ890è¡Œï¼‰

### ğŸš§ è¿›è¡Œä¸­ï¼ˆv0.3.0ï¼‰
- [x] HTMLå¯è§†åŒ–æŠ¥å‘Šï¼ˆå·²å®Œæˆï¼Œä¸“ä¸šæµ‹è¯•æŠ¥å‘Šç”Ÿæˆï¼‰
- [ ] å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ>80%ï¼‰
- [ ] Bugä¿®å¤ï¼šJSONæŠ¥å‘Šåºåˆ—åŒ–é—®é¢˜ã€æ€§èƒ½è®¡æ—¶å™¨è´Ÿæ•°
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¼‚æ­¥APIè°ƒç”¨ï¼Œå¤§æ–‡ä»¶å¹¶è¡Œè¯„ä¼°ï¼‰
- [ ] ç¼“å­˜æœºåˆ¶ï¼ˆå‡å°‘é‡å¤APIè°ƒç”¨ï¼‰
- [ ] éªŒè¯è§„åˆ™ä¼˜åŒ–ï¼ˆåŒºåˆ†ä¸¥é‡é”™è¯¯å’Œè­¦å‘Šï¼‰

### ğŸ“‹ æœªæ¥è®¡åˆ’ï¼ˆv1.0.0+ï¼‰
- [ ] Webç•Œé¢ï¼ˆå‰§æœ¬ä¸Šä¼ â†’è½¬æ¢â†’è¯„ä¼°ï¼‰
- [ ] äº¤äº’å¼è¯„ä¼°ä»ªè¡¨æ¿
- [ ] æ›´å¤šè¯„ä¼°æŒ‡æ ‡ï¼ˆMINEAã€ä¸€è‡´æ€§æ£€æµ‹ï¼‰
- [ ] æ”¯æŒæ›´å¤šLLMæä¾›å•†ï¼ˆOpenAIã€Claudeï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆè‹±æ–‡å‰§æœ¬ï¼‰

## ğŸ’¡ é¡¹ç›®å·¥ä½œåŸç†

### æ•´ä½“æµç¨‹

```
è¾“å…¥å‰§æœ¬æ–‡æœ¬
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: LLMè½¬æ¢ï¼ˆDeepSeek APIï¼‰      â”‚
â”‚  - ä½¿ç”¨promptæ¨¡æ¿æŒ‡å¯¼LLM             â”‚
â”‚  - æå–åœºæ™¯ä¿¡æ¯ä¸ºJSON               â”‚
â”‚  - æ¸©åº¦: 0.1(æ ‡å‡†) / 0.2(å¤§çº²)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2: ç»“æ„éªŒè¯ï¼ˆPydantic V2ï¼‰     â”‚
â”‚  - SceneInfo / OutlineSceneInfo     â”‚
â”‚  - å­—æ®µæ ¼å¼ã€ç±»å‹ã€å¿…å¡«é¡¹æ£€æŸ¥        â”‚
â”‚  - éªŒè¯æˆåŠŸç‡: 100%                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3: ä¸‰å±‚è¯„ä¼°                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç»“æ„å±‚: JSON schemaéªŒè¯        â”‚  â”‚
â”‚  â”‚ å¾—åˆ†: 1.0 or 0.0              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç»Ÿè®¡å±‚: åœºæ™¯è¾¹ç•Œ + è§’è‰²æå–    â”‚  â”‚
â”‚  â”‚ æŒ‡æ ‡: F1, Precision, Recall   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è¯­ä¹‰å±‚: LLM-as-Judgeè¯„ä¼°      â”‚  â”‚
â”‚  â”‚ è¯„ä¼°: åœºæ™¯ä»»åŠ¡ã€å…³é”®äº‹ä»¶ç­‰     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤4: åˆ†æ•°èšåˆ                    â”‚
â”‚  æ€»åˆ† = ç»“æ„Ã—0.25 + è¾¹ç•ŒÃ—0.25      â”‚
â”‚        + è§’è‰²Ã—0.25 + è¯­ä¹‰Ã—0.25     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¾“å‡ºè¯„ä¼°æŠ¥å‘Šï¼ˆJSONï¼‰+ è½¬æ¢åçš„JSON
```

### å…³é”®åŒºåˆ«ï¼šæ ‡å‡†å‰§æœ¬ vs æ•…äº‹å¤§çº²

| ç‰¹æ€§ | æ ‡å‡†å‰§æœ¬ | æ•…äº‹å¤§çº² |
|------|---------|---------|
| **scene_id** | S01, S02ï¼ˆä¸¥æ ¼ï¼‰ | S0, S1, S01ï¼ˆçµæ´»ï¼‰ |
| **setting** | å¿…é¡»åŒ…å«"å†…/å¤–" | å…è®¸"æ¨æ–­ï¼š"ã€None |
| **key_events** | 1-3ä¸ª | 1-5ä¸ª |
| **éªŒè¯ç­–ç•¥** | ä¸¥æ ¼é”™è¯¯ | å‹å¥½è­¦å‘Š |
| **promptæ¸©åº¦** | 0.1 | 0.2 |
| **ä½¿ç”¨è„šæœ¬** | convert_script_to_json.py<br>run_full_evaluation.py | convert_outline_to_json.py<br>run_outline_evaluation.py |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### å¦‚ä½•è´¡çŒ®
1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ [Issue](https://github.com/your-repo/issues)
- å‘èµ· [Pull Request](https://github.com/your-repo/pulls)

---

**å¼€å‘å›¢é˜Ÿ** | 2025 | åŸºäºDeepSeek API + DeepEvalæ¡†æ¶æ„å»º
